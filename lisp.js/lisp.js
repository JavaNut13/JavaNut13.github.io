function parseType(e){for(type in types){var t=types[type].re.exec(e);if(t){var r=t[0],n=t[1]||r;return{type:type,cont:!types[type].ignore&&n,length:r.length}}}}function parseAtom(e){var t=parseType(e);if(!t)return null;var r=t.length;if(delete t.length,"list-start"===t.type)return parseList(e);if("whitespace"===t.type){var n=parseAtom(e.substring(r));return n.length+=r,n}if("quote"===t.type){var o=parseAtom(e.substring(r));return r+=o.length,delete o.length,t.cont=o.result,{length:r,result:t}}return{length:r,result:t}}function parseList(e){for(var t,r,n=e.startsWith("["),o=e.substring(1),i=1,g=[];result=parseAtom(o);){if(t=result.result,r=result.length,t.cont){if("list-end"===t.type){i+=r;break}g.push(t)}o=o.substring(r),i+=r}return n?{result:{type:"quote",cont:{type:"list",cont:g}},length:i}:{result:{type:"list",cont:g},length:i}}function parseProgram(e){for(var t=e,r=[];result=parseAtom(t);)r.push(result.result),t=t.substring(result.length);return r}function generate(e){var t=generator[e.type];if(!t)throw"Unexpected symbol "+JSON.stringify(e.cont);return t(e)+";"}function map(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=e(t[n]);return r}function filter(e,t){for(var r=[],n=0;n<t.length;n++)e(t[n])&&(r.push(t[n]));return r}function reduce(e,t,r){for(var n=t,o=0;o<r.length;o++)t=e(t,r[o]);return n}var types={"list-start":{re:/^\(|^\[/,ignore:!1},"list-end":{re:/^\)|^\]/,ignore:!1},number:{re:/^\d*\.\d+|^\d+/,ignore:!1},iden:{re:/^[\w\-+*!@#$%\^&\d\.=<>:]+/,ignore:!1},string:{re:/^"(.*?)"/,ignore:!1},whitespace:{re:/^\s+|^;.*?\n/,ignore:!0},quote:{re:/^'/,ignore:!1}},generator={};generator.get=function(e){return generator[e.type](e)},generator.getAll=function(e,t){t=t||0;for(var r=[];t<e.length;t++)r.push(generator.get(e[t]));return r},generator.builtins={},generator.infix_operators={"+":!0,"-":!0,"/":!0,"*":!0,"%":!0,"&&":!0,"||":!0,"<":!0,">":!0,"<=":!0,">=":!0,"=":"==="},generator.infix=function(e){var t=generator.get(e.cont[0]);generator.infix_operators[t]!==!0&&(t=generator.infix_operators[t]);var r=generator.getAll(e.cont.slice(1));return"("+r.join(t)+")"},generator.builtins.fn=function(e){var t=generator.getAll(e[0].cont.cont),r=generator.getAll(e.slice(1)),n=r[r.length-1];r[r.length-1]="return "+n;var o=r.join(";\n"),i="function("+t.join(", ")+") {\n";return i+=o,i+=";\n}"},generator.builtins.defn=function(e){var t=generator.get(e[0]),r=generator.getAll(e[1].cont.cont),n=generator.getAll(e.slice(2)),o=n[n.length-1];n[n.length-1]="return "+o;var i=n.join(";\n"),g="function "+t+"("+r.join(", ")+") {\n";return g+=i,g+=";\n}"},generator.builtins.def=function(e){return"var "+generator.get(e[0])+"="+generator.get(e[1])},generator.builtins["if"]=function(e){var t=generator.get(e[0]),r=generator.get(e[1]),n=generator.get(e[2]);return"("+t+"?"+r+":"+n+")"},generator.string=function(e){return'"'+e.cont+'"'},generator.number=function(e){return e.cont},generator.iden=function(e){return e.cont},generator.quote=function(e){var t=e.cont;if("list"===t.type){for(var r=[],n=t.cont,o=0;o<n.length;o++){var i=n[o];r.push(generator.get(i))}return"["+r.join(", ")+"]"}return generator.get(i)},generator.list=function(e){var t=generator.get(e.cont[0]);if(generator.builtins[t])return generator.builtins[t](e.cont.slice(1));if(generator.infix_operators[t])return generator.infix(e);if(t.startsWith("."))var r=generator.get(e.cont[1])+t+"(",n=2;else{if(t.startsWith(":"))return this.get(e.cont[1])+"."+t.slice(1);var r=t+"(",n=1}return r+=generator.getAll(e.cont,n).join(", "),r+=")"};